//
//  MarketDataModel.swift
//  CoinApp
//
//  Created by song on 2022/11/23.
//

import Foundation

// JSON data:
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
 "data": {
 "active_cryptocurrencies": 13209,
 "upcoming_icos": 0,
 "ongoing_icos": 49,
 "ended_icos": 3376,
 "markets": 608,
 "total_market_cap": {
 "btc": 52119726.66261314,
 "eth": 739394075.3823243,
 "ltc": 11033220476.777195,
 "bch": 7497231906.887861,
 "bnb": 2914035065.584263,
 "eos": 948421259377.7544,
 "xrp": 2281806377892.642,
 "xlm": 9746026657958.332,
 "link": 132339484028.75748,
 "dot": 159150419785.98575,
 "yfi": 137026236.65705758,
 "usd": 863209657690.2008,
 "aed": 3170590652937.552,
 "ars": 142004462762470.75,
 "aud": 1298872435136.1052,
 "bdt": 88066975627581.64,
 "bhd": 325420545642.9714,
 "bmd": 863209657690.2008,
 "brl": 4625767913630.248,
 "cad": 1155880892130.064,
 "chf": 821880042489.6512,
 "clp": 799763747849970.1,
 "cny": 6177214631396.861,
 "czk": 20380551796787.516,
 "dkk": 6225824556850.362,
 "eur": 837066489997.3943,
 "gbp": 725784090556.9471,
 "hkd": 6747666733681.423,
 "huf": 339684706287262.1,
 "idr": 13548840837842350,
 "ils": 2988295447797.5605,
 "inr": 70591984948950.28,
 "jpy": 122123257708928.69,
 "krw": 1168647580830066.5,
 "kwd": 265876343455.5011,
 "lkr": 315998929890436.7,
 "mmk": 1805707195868846.5,
 "mxn": 16776147361490.85,
 "myr": 3949184183932.668,
 "ngn": 381348684885507.94,
 "nok": 8689874652129.837,
 "nzd": 1398252899816.3162,
 "php": 49239208746803.07,
 "pkr": 192931223083397.16,
 "pln": 3933057701107.7,
 "rub": 52237130708703.33,
 "sar": 3244120577998.9155,
 "sek": 9153838621412.762,
 "sgd": 1194241066108.161,
 "thb": 31307181356391.812,
 "try": 16080301108281.906,
 "twd": 26950959290471.938,
 "uah": 31746050094506.402,
 "vef": 86433183024.51993,
 "vnd": 21451533573610788,
 "zar": 14887088988085.734,
 "xdr": 642220216434.5925,
 "xag": 40794485637.45727,
 "xau": 496872111.0630565,
 "bits": 52119726662613.14,
 "sats": 5211972666261314
 },
 "total_volume": {
 "btc": 3925053.865842815,
 "eth": 55682593.90052526,
 "ltc": 830894316.9522599,
 "bch": 564604631.7499032,
 "bnb": 219451354.25235507,
 "eos": 71424099260.26126,
 "xrp": 171839215555.15054,
 "xlm": 733957794100.7672,
 "link": 9966276430.28922,
 "dot": 11985365435.148865,
 "yfi": 10319228.329692679,
 "usd": 65006948825.389404,
 "aed": 238772148209.37604,
 "ars": 10694130633892.75,
 "aud": 97816020904.51244,
 "bdt": 6632184112893.302,
 "bhd": 24506904630.734745,
 "bmd": 65006948825.389404,
 "brl": 348359237365.4967,
 "cad": 87047554824.63773,
 "chf": 61894481122.578545,
 "clp": 60228938086723.21,
 "cny": 465196226489.37024,
 "czk": 1534826998150.2598,
 "dkk": 468856962798.57385,
 "eur": 63038148373.26357,
 "gbp": 54657647551.540886,
 "hkd": 508156068620.62823,
 "huf": 25581115922023.76,
 "idr": 1020341692359823.8,
 "ils": 225043785735.5837,
 "inr": 5316170309468.45,
 "jpy": 9196908646176.621,
 "krw": 88008993881299.19,
 "kwd": 20022725300.759365,
 "lkr": 23797377706862.77,
 "mmk": 135984942047082.06,
 "mxn": 1263385022746.1458,
 "myr": 297406790876.15643,
 "ngn": 28718764001455.152,
 "nok": 654420663366.572,
 "nzd": 105300205915.83038,
 "php": 3708126634925.6577,
 "pkr": 14529344098584.406,
 "pln": 296192331058.20056,
 "rub": 3933895378154.5527,
 "sar": 244309570124.22015,
 "sek": 689361053269.8835,
 "sgd": 89936398623.48935,
 "thb": 2357694122361.8228,
 "try": 1210981946193.7664,
 "twd": 2029633954836.5447,
 "uah": 2390744630248.8853,
 "vef": 6509145785.88625,
 "vnd": 1615480935393234.2,
 "zar": 1121123035853.2786,
 "xdr": 48364584863.55046,
 "xag": 3072167945.0254974,
 "xau": 37418649.813382395,
 "bits": 3925053865842.815,
 "sats": 392505386584281.5
 },
 "market_cap_percentage": {
 "btc": 36.866943152607504,
 "eth": 16.30097083681728,
 "usdt": 7.587941677651081,
 "bnb": 5.6073085765292,
 "usdc": 5.1067720470246725,
 "busd": 2.638228582373537,
 "xrp": 2.212220831812288,
 "doge": 1.306029430996594,
 "ada": 1.2878231747896285,
 "matic": 0.8896194696597594
 },
 "market_cap_change_percentage_24h_usd": 6.018011430056087,
 "updated_at": 1669196402
 }
 }
 */

struct GlobalData: Codable {
  let data: MarketDataModel?
}


struct MarketDataModel: Codable {
  let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
  let marketCapChangePercentage24HUsd: Double
  
  enum CodingKeys: String, CodingKey {
    case totalMarketCap = "total_market_cap"
    case totalVolume = "total_volume"
    case marketCapPercentage = "market_cap_percentage"
    case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
  }
  
  var marketCap: String {
    if let item = totalMarketCap.first(where: { $0.key == "usd"}) {
      return  "$" + item.value.formattedWithAbbreviations()
    }
    return ""
  }
  
  var volum: String {
    if let item = totalVolume.first(where: { $0.key == "usd"}) {
      return "$" + item.value.formattedWithAbbreviations()
    }
    return ""
  }
  
  var btcDominance: String {
    if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
      return "\(item.value.asPercentString())"
    }
    return ""
  }
}
